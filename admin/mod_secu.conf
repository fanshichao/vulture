#######################################
# This file was generated by Vulture  #
# Do not edit manually                # 
#######################################

# mod_security configuration "{{conf.name}}"

{% if conf.version and "/" not in appname %}
# Specify CRS version in the audit logs
SecComponentSignature "core ruleset/{{conf.version}}"
{% endif %}

{% if conf.action == 'Log_Only' %}
# Process rules, but no transaction interception
SecRuleEngine DetectionOnly
SecAuditEngine On
SecDefaultAction "phase:2,pass,nolog,auditlog"
{% else %}{% if conf.action == 'Log_Block' %}
# Process rules
SecRuleEngine On
SecAuditEngine RelevantOnly
SecDefaultAction "phase:2,deny,nolog,auditlog"
{% endif %}{% endif %}

{% if conf.motor == 'Anomaly' %}
# use anomaly scoring mode
SecAction "phase:1,id:'981206',t:none,nolog,pass,setvar:tx.anomaly_score_blocking=on"
SecAction "phase:1,id:'981207',t:none,nolog,pass,setvar:tx.critical_anomaly_score={{conf.critical_score}},setvar:tx.error_anomaly_score={{conf.error_score}},setvar:tx.warning_anomaly_score={{conf.warning_score}},setvar:tx.notice_anomaly_score={{conf.notice_score}}"
SecAction "phase:1,id:'981208',t:none,nolog,pass,setvar:tx.inbound_anomaly_score_level={{conf.inbound_score}}"
SecAction "phase:1,id:'981209',t:none,nolog,pass,setvar:tx.outbound_anomaly_score_level={{conf.outbound_score}}"
{% endif %}

{% if conf.paranoid %}
# use paranoid mode
SecAction "phase:1,id:'981210',t:none,nolog,pass,setvar:tx.paranoid_mode=1"
{% endif %}

{% if conf.UTF %}
# validate utf8 encoding
SecAction "phase:1,id:'981216',t:none,nolog,pass,setvar:tx.crs_validate_utf8_encoding=1"
{% endif %}

{% if conf.XML %}
# process xml
SecRule REQUEST_HEADERS:Content-Type "text/xml" "chain,phase:1,id:'981053',t:none,t:lowercase,pass,nolog"
SecRule REQBODY_PROCESSOR "!@streq XML" "ctl:requestBodyProcessor=XML"
{% endif %}

{% if conf.BodyAccess %}
SecRequestBodyAccess On
{% endif %}

{% if conf.max_num_args %}
SecAction "phase:1,id:'981211',t:none,nolog,pass,setvar:tx.max_num_args={{conf.max_num_args}}"
{% else %}
#SecAction "phase:1,id:'981211',t:none,nolog,pass,setvar:tx.max_num_args="
{% endif %}

{% if conf.arg_name_length %}
SecAction "phase:1,t:none,nolog,pass,setvar:tx.arg_name_length={{conf.arg_name_length}}"
{% else %}
#SecAction "phase:1,t:none,nolog,pass,setvar:tx.arg_name_length=100"
{% endif %}

{% if conf.arg_length %}
SecAction "phase:1,t:none,nolog,pass,setvar:tx.arg_length={{conf.arg_length}}"
{% else %}
#SecAction "phase:1,t:none,nolog,pass,setvar:tx.arg_length=400"
{% endif %}

{% if conf.total_arg_length %}
SecAction "phase:1,t:none,nolog,pass,setvar:tx.total_arg_length={{conf.total_arg_length}}"
{% else %}
#SecAction "phase:1,t:none,nolog,pass,setvar:tx.total_arg_length=64000"
{% endif %}

{% if conf.max_file_size %}
SecAction "phase:1,t:none,nolog,pass,setvar:tx.max_file_size={{conf.max_file_size}}"
{% else %}
#SecAction "phase:1,t:none,nolog,pass,setvar:tx.max_file_size=1048576"
{% endif %}

{% if conf.combined_file_size %}
SecAction "phase:1,t:none,nolog,pass,setvar:tx.combined_file_sizes={{conf.combined_file_size}}"
{% else %}
#SecAction "phase:1,t:none,nolog,pass,setvar:tx.combined_file_sizes=1048576"
{% endif %}

{% if conf.allowed_http %}
# allowed/restricted HTTP methods, versions, request_content_types,
#                           headers, extensions
SecAction "phase:1,id:'981212',t:none,nolog,pass, setvar:'tx.allowed_methods={{conf.allowed_http}}', setvar:'tx.allowed_request_content_type={{conf.allowed_content_type}}', setvar:'tx.allowed_http_versions={{conf.allowed_http_version}}', setvar:'tx.restricted_extensions={{conf.restricted_extensions}}', setvar:'tx.restricted_headers={{conf.restricted_headers}}'"
{% endif %}

{% if conf.BT_activated %}
SecAction "phase:1,id:'981214',t:none,nolog,pass, setvar:'tx.brute_force_protected_urls={{conf.protected_urls}}', setvar:'tx.brute_force_burst_time_slice={{conf.BT_burst_time_slice}}', setvar:'tx.brute_force_counter_threshold={{conf.BT_counter_threshold}}', setvar:'tx.brute_force_block_timeout={{conf.BT_block_timeout}}'"
{% endif %}

{% if conf.DoS_activated %}
SecAction "phase:1,id:'981215',t:none,nolog,pass, setvar:'tx.dos_burst_time_slice={{conf.DoS_burst_time_slice}}', setvar:'tx.dos_counter_threshold={{conf.DoS_counter_threshold}}', setvar:'tx.dos_block_timeout={{conf.DoS_block_timeout}}'"
{% endif %}

{% if conf.Custom %}
{{conf.Custom|safe}}
{% endif %}

SecRule REQUEST_HEADERS:User-Agent "^(.*)$" "phase:1,id:'981217',t:none,pass,nolog,t:sha1,t:hexEncode,setvar:tx.ua_hash=%{matched_var}"

SecRule REQUEST_HEADERS:x-forwarded-for "^\b(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\b" "phase:1,id:'981225',t:none,pass,nolog,capture,setvar:tx.real_ip=%{tx.1}"
SecRule &TX:REAL_IP "!@eq 0" "phase:1,id:'981226',t:none,pass,nolog,initcol:global=global,initcol:ip=%{tx.real_ip}_%{tx.ua_hash}"
SecRule &TX:REAL_IP "@eq 0"  "phase:1,id:'981218',t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}_%{tx.ua_hash}"
 
