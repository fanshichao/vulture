{% extends "base.html" %}
{% load i18n %}

{% block title %}
	{% trans "Web Applications" %} - <small>{% trans "Application's settings" %}</small>
{% endblock %}

{% block tabs %}
    <li><a href="/app/">{% trans "List" %}</a></li>
    <li><a href="javascript:swapTab(1, 8, 'main_tab_', 'main_content_');" id="main_tab_1" class="active">{% trans "Main settings" %}</a></li>
    <li><a href="javascript:swapTab(2, 8, 'main_tab_', 'main_content_');" id="main_tab_2">{% trans "Authentication" %}</a></li>
    <li><a href="javascript:swapTab(3, 8, 'main_tab_', 'main_content_');" id="main_tab_3">{% trans "ACL" %}</a></li>
    <li><a href="javascript:swapTab(4, 8, 'main_tab_', 'main_content_');" id="main_tab_4">{% trans "SSO Forward" %}</a></li>
    <li><a href="javascript:swapTab(5, 8, 'main_tab_', 'main_content_');" id="main_tab_5">{% trans "Mod security" %}</a></li>
    <li><a href="javascript:swapTab(6, 8, 'main_tab_', 'main_content_');" id="main_tab_6">{% trans "Headers" %}</a></li>
    <li><a href="javascript:swapTab(7, 8, 'main_tab_', 'main_content_');" id="main_tab_7">{% trans "Timeout" %}</a></li>
    <li><a href="javascript:swapTab(8, 8, 'main_tab_', 'main_content_');" id="main_tab_8">{% trans "Advanced settings" %}</a></li>
{% endblock %}

{% block content %}
    <script type='text/javascript'>
        var nbheaders = {{ form.header|length }};
        function addRowTo(table) {
            nbheaders++;
            var name = 'table.' + nbheaders;
            var d = document.getElementById(table);
            var newdiv = document.createElement('tr');
            newdiv.setAttribute('id',name);
            newdiv.innerHTML = '<input type="hidden" name="header_id-' + nbheaders +'"" value="' + nbheaders +'" />';

            var col1 = document.createElement('td');
            col1.innerHTML = '<input id="id_field_desc-' + nbheaders +'" type="text" name="field_desc-' + nbheaders +'" maxlength="128" />';
            
            var col2 = document.createElement('td');
            col2.innerHTML = '<select name="field_type-' + nbheaders +'"" id="id_field_type-' + nbheaders +'">';

            var col3 = document.createElement('td');
            col3.innerHTML = '<input id="id_field_value-' + nbheaders +'" type="text" name="field_value-' + nbheaders +'" maxlength="50" />';

            var col4 = document.createElement('td');
            col4.innerHTML = '<a onclick="delRowTo(\'tbl1body\',\'' + name +'\')" href="#"><img src="/img/vulture2/trash.png"></a>';

            newdiv.appendChild(col1);
            newdiv.appendChild(col2);
            newdiv.appendChild(col3);
            newdiv.appendChild(col4);                 
            d.appendChild(newdiv);
            populateList('id_field_type-'+ nbheaders,['CUSTOM', 'REMOTE_ADDR', 'SSL_CLIENT_I_DN', 'SSL_CLIENT_M_SERIAL', 'SSL_CLIENT_S_DN', 'SSL_CLIENT_V_START', 'SSL_CLIENT_V_END', 'SSL_CLIENT_S_DN_C', 'SSL_CLIENT_S_DN_ST', 'SSL_CLIENT_S_DN_Email', 'SSL_CLIENT_S_DN_L', 'SSL_CLIENT_S_DN_O', 'SSL_CLIENT_S_DN_OU', 'SSL_CLIENT_S_DN_CN', 'SSL_CLIENT_S_DN_T', 'SSL_CLIENT_S_DN_I', 'SSL_CLIENT_S_DN_G', 'SSL_CLIENT_S_DN_S', 'SSL_CLIENT_S_DN_D', 'SSL_CLIENT_S_DN_UID']);
        }

        function populateList(div, array) {
            var arLen=array.length;
            for(var i=0; i<arLen; i++){
                document.getElementById(div).options[i]=new Option(array[i], array[i]);
            }
        }

        function changeHiddenField(value) {
            var d = document.getElementById('nbheaders');
            d.setAttribute('value',value);
        }

        function delRowTo(table, row) {
              var d = document.getElementById(table);
              var olddiv = document.getElementById(row);
              d.removeChild(olddiv);
        }
    </script>
    <form method="post" id="app" action=".">
        {{ form.up.as_hidden }}
        <div id="main_content_1" class="main_content">
            <table>
                <tr><th>{% trans "Internet name" %}</th><td class="input">{{ form.name }}{% if form.name.errors %}<div class="error">{{ form.name.errors|join:", " }}</div>{% endif %}</td><td><span class="require">*</span><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Interface" %}</th><td class="input">{{ form.intf }}{% if form.intf.errors %}<div class="error">{{ form.intf.errors|join:", " }}</div>{% endif %}</td><td><span class="require">*</span><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Private URL" %}</th><td class="input">{{ form.url }}{% if form.url.errors %}<div class="error">{{ form.url.errors|join:", " }}</div>{% endif %}</td><td><span class="require">*</span><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Log" %}</th><td class="input">{{ form.log }}{% if form.log.errors %}<div class="error">{{ form.log.errors|join:", " }}</div>{% endif %}</td><td><span class="require">*</span><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Appearance" %}</th><td class="input">{{ form.appearance }}{% if form.appearance.errors %}<div class="error">{{ form.appearance.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
            </table>
        </div>
        
        <div id="main_content_2" class="main_content">
            <table>
                <tr><th>{% trans "Authentication" %}</th><td class="input">{{ form.auth }}{% if form.auth.errors %}<div class="error">{{ form.auth.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Basic Auth" %}</th><td class="input">{{ form.auth_basic }}{% if form.auth_basic.errors %}<div class="error">{{ form.auth_basic.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Display portal" %}</th><td class="input">{{ form.display_portal }}{% if form.display_portal.errors %}<div class="error">{{ form.display_portal.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
            </table>
        </div>
        
        <div id="main_content_3" class="main_content">
            <table>
                <tr><th>{% trans "ACL" %}</th><td class="input">{{ form.acl }}{% if form.acl.errors %}<div class="error">{{ form.acl.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
            </table>
        </div>
        
        <div id="main_content_4" class="main_content">
            <table>
                <tr><th>{% trans "SSO Forward" %}</th><td class="input">{{ form.sso_forward }}{% if form.sso_forward.errors %}<div class="error">{{ form.sso_forward.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Logon URL" %}</th><td class="input">{{ form.logon_url }}{% if form.logon_url.errors %}<div class="error">{{ form.logon_url.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Logout URL" %}</th><td class="input">{{ form.logout_url }}{% if form.logout_url.errors %}<div class="error">{{ form.logout_url.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
            </table>
        </div>
        
        <div id="main_content_5" class="main_content">
            <table>
                <tr><th>{% trans "Mod security" %}</th><td class="input">{{ form.security }}{% if form.security.errors %}<div class="error">{{ form.security.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
            </table>
        </div>
        
        <div id='main_content_6' class="main_content">
            <input type='hidden' name='nbheaders' value='0'><br>
            <table id="fields">
                <tbody id="tbl1body">
                    <tr>
                        <th style="width: 200px">{% trans "Header name" %}</th>
                        <th>{% trans "Type" %}</th>
                        <th>{% trans "Value" %}</th>
                        <th style="width: 16px"><a href="#" onClick="addRowTo('tbl1body')"><img src="/img/vulture2/add.png" alt="add" /></a></th>
                    </tr>
                    {% for header in form.header %}
                        <tr id="table.{{forloop.counter}}">
                            <input type="hidden" name="header_id-{{forloop.counter}}" value="{{ forloop.counter }}" />
                            <input type="hidden" name="field_desc-{{forloop.counter}}" value="{{ header.name }}" />
                            <input type="hidden" name="field_type-{{forloop.counter}}" value="{{ header.type }}" />
                            <input type="hidden" name="field_value-{{forloop.counter}}" value="{{ header.value }}" />
                            <td>{{ header.name }}{% if header.name.errors %}<div class="error">{{ header.name.errors|join:", " }}</div>{% endif %}</td>
                            <td>{{ header.type }}{% if header.type.errors %}<div class="error">{{ header.type.errors|join:", " }}</div>{% endif %}</td>
                            <td>{{ header.value }}{% if header.value.errors %}<div class="error">{{ header.value.errors|join:", " }}</div>{% endif %}</td>
                            <td><a onclick="delRowTo('tbl1body','table.{{forloop.counter}}')" href="#"><img src="/img/vulture2/trash.png" alt="delete" /></a></td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div id="main_content_7" class="main_content">
            <table>
                <tr><th>{% trans "Timeout for user session (leave blank for no timeout)" %}</th><td class="input">{{ form.timeout }}{% if form.timeout.errors %}<div class="error">{{ form.timeout.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Update user session timeout each time he does smth" %}</th><td class="input">{{ form.update_access_time }}{% if form.update_access_time.errors %}<div class="error">{{ form.update_access_time.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
            </table>
        </div>
        
        <div id="main_content_8" class="main_content">
            <table>
                <tr><th>{% trans "Canonicalise URL" %}</th><td class="input">{{ form.canonicalise_url }}{% if form.canonicalise_url.errors %}<div class="error">{{ form.canonicalise_url.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
                <tr><th>{% trans "Add VirtualHost directives" %}</th><td class="input">{{ form.virtualhost_directives }}{% if form.virtualhost_directives.errors %}<div class="error">{{ form.virtualhost_directives.errors|join:", " }}</div>{% endif %}</td><td><img src="/img/vulture2/agt_support.png" alt="support" class="support" /></td></tr>
            </table>
        </div>
        <br />
        <input type="submit" value="{% trans "Save settings" %}" onClick="changeHiddenField(nbheaders);"/>
        <input type="button" onclick="document.location='/app/'" value="{% trans "Cancel" %}"/>
    </form>
{% endblock %}